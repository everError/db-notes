# DB Collation (데이터 정렬)

## 1\. Collation 이란?

\*\*Collation(데이터 정렬)\*\*은 데이터베이스에서 **문자열 데이터를 정렬하고 비교하는 규칙의 집합**을 의미합니다. 데이터베이스는 이 규칙에 따라 특정 열(Column)의 데이터를 정렬(`ORDER BY`)하거나, 두 문자열 값이 같은지 다른지를 비교(`WHERE` 절, `JOIN` 조건 등)합니다.

단순히 문자를 알파벳 순서로 나열하는 것 이상으로, Collation은 다음과 같은 세부적인 규칙을 포함합니다.

- **대소문자 구분 (Case Sensitivity)**: 'A'와 'a'를 같은 문자로 취급할지, 다른 문자로 취급할지를 결정합니다.
- **악센트 구분 (Accent Sensitivity)**: 'a'와 'á'를 같은 문자로 취급할지, 다른 문자로 취급할지를 결정합니다.
- **전자/반자 구분 (Width Sensitivity)**: 전각 문자('Ａ')와 반각 문자('A')를 같은 문자로 취급할지, 다른 문자로 취급할지를 결정합니다.
- **가나(Kana) 구분 (Kana Sensitivity)**: 일본어의 히라가나와 가타카나를 구분할지 여부를 결정합니다.

어떤 Collation을 사용하느냐에 따라 쿼리의 결과가 달라질 수 있으므로, 데이터베이스를 설계할 때 매우 중요한 요소입니다.

---

## 2\. Collation의 적용 범위

Collation은 데이터베이스 시스템의 여러 계층에서 설정할 수 있으며, 하위 계층은 상위 계층의 설정을 상속받는 것이 일반적입니다.

1.  **서버 (Server) 레벨**: 데이터베이스 서버 인스턴스 전체에 적용되는 기본 Collation입니다. 서버 설치 시 설정하며, 별도로 지정하지 않으면 OS의 로캘(Locale) 설정을 따라가는 경우가 많습니다. 시스템 데이터베이스들은 이 설정을 따릅니다.
2.  **데이터베이스 (Database) 레벨**: 특정 데이터베이스에 적용되는 Collation입니다. 데이터베이스를 생성할 때 지정할 수 있으며, 지정하지 않으면 서버 레벨의 Collation을 상속받습니다. 이 데이터베이스 안에 생성되는 모든 테이블과 컬럼의 기본값이 됩니다.
3.  **테이블 (Table) 레벨**: 특정 테이블에 적용되는 Collation입니다. 테이블을 생성할 때 지정할 수 있으며, 이 테이블 안의 모든 문자열 타입 컬럼에 기본으로 적용됩니다.
4.  **컬럼 (Column) 레벨**: 특정 컬럼에만 적용되는 Collation입니다. 테이블을 생성하거나 수정할 때 각 컬럼별로 다른 Collation을 지정할 수 있습니다. 가장 우선순위가 높습니다.
5.  **표현식 (Expression) 레벨**: `COLLATE` 절을 사용하여 특정 쿼리문이나 표현식에 임시로 다른 Collation을 적용할 수 있습니다.

<!-- end list -->

```sql
-- 예시: 쿼리에서 특정 Collation 적용하기 (SQL Server)
SELECT *
FROM MyTable
ORDER BY MyColumn COLLATE Latin1_General_CS_AS;
```

---

## 3\. Collation 이름의 구조와 의미

Collation 이름은 보통 특정 형식으로 구성되어 있으며, 이름 자체에 해당 Collation의 규칙에 대한 정보가 담겨 있습니다. (예: `SQL_Latin1_General_CP1_CI_AS`)

| 접미사                 | 의미               | 설명                                                                                                                            |
| :--------------------- | :----------------- | :------------------------------------------------------------------------------------------------------------------------------ |
| **\_CS**               | Case-Sensitive     | 대소문자를 구분합니다. ('A'와 'a'를 다르게 취급)                                                                                |
| **\_CI**               | Case-Insensitive   | 대소문자를 구분하지 않습니다. ('A'와 'a'를 같게 취급)                                                                           |
| **\_AS**               | Accent-Sensitive   | 악센트를 구분합니다. ('a'와 'á'를 다르게 취급)                                                                                  |
| **\_AI**               | Accent-Insensitive | 악센트를 구분하지 않습니다. ('a'와 'á'를 같게 취급)                                                                             |
| **\_KS**               | Kana-Sensitive     | 일본어 가나(히라가나/가타카나)를 구분합니다.                                                                                    |
| **\_WS**               | Width-Sensitive    | 전자/반자를 구분합니다. ('Ａ'와 'A'를 다르게 취급)                                                                              |
| **\_BIN** / **\_BIN2** | Binary             | 이진(Binary) 정렬. 문자의 코드 값 자체를 기준으로 정렬하므로 가장 빠르고 엄격합니다. BIN2는 코드 포인트 순서를 정확히 따릅니다. |

**예시: `Korean_Wansung_CI_AS`**

- `Korean_Wansung`: 한국어 완성형 문자 집합을 기준으로 합니다.
- `CI`: 대소문자를 구분하지 않습니다 (Case-Insensitive).
- `AS`: 악센트를 구분합니다 (Accent-Sensitive).

---

## 4\. Collation이 쿼리에 미치는 영향

간단한 예시를 통해 Collation 설정이 실제 쿼리 결과에 어떻게 영향을 미치는지 살펴보겠습니다.

`Users`라는 테이블에 `Name` 컬럼이 있고, 다음과 같은 데이터가 저장되어 있다고 가정합니다.

| ID  | Name     |
| :-- | :------- |
| 1   | 'apple'  |
| 2   | 'Apple'  |
| 3   | 'Banana' |

**CASE 1: 대소문자를 구분하지 않는 Collation (`_CI`)**

```sql
SELECT * FROM Users WHERE Name = 'apple';
```

이 쿼리는 'apple'과 'Apple'을 같은 값으로 간주하므로 **ID가 1과 2인 두 개의 행을 모두 반환**합니다.

**CASE 2: 대소문자를 구분하는 Collation (`_CS`)**

```sql
SELECT * FROM Users WHERE Name = 'apple';
```

이 쿼리는 'apple'과 'Apple'을 다른 값으로 간주하므로 **ID가 1인 행만 반환**합니다.

이처럼 `ORDER BY` 절을 사용한 정렬 순서뿐만 아니라, `WHERE` 절의 조건, `JOIN` 키의 일치 여부, `UNIQUE` 제약 조건, `PRIMARY KEY` 등 문자열 비교가 일어나는 모든 곳에서 Collation은 중요한 역할을 합니다.

---

## 5\. 선택 가이드

- **일관성 유지**: 특별한 이유가 없다면 데이터베이스 내의 모든 컬럼은 동일한 Collation을 사용하는 것이 좋습니다. 서로 다른 Collation을 사용하는 컬럼끼리 비교하거나 조인할 때 예기치 않은 오류가 발생하거나 성능이 저하될 수 있습니다.
- **언어 및 데이터 특성 고려**: 저장하려는 데이터의 언어와 특성에 맞는 Collation을 선택해야 합니다. 다국어를 지원해야 한다면 `UTF-8`과 같은 유니코드 문자 집합을 기반으로 하는 Collation(예: `utf8mb4_general_ci`, `UTF8MB4_UNICODE_CI` 등)을 사용하는 것이 표준입니다.
- **성능과 정확성**: 일반적으로 바이너리(Binary) 정렬(`_BIN`)이 가장 빠르지만, 언어적 규칙을 고려하지 않아 사용자가 기대하는 정렬 결과와 다를 수 있습니다. 반면, 언어별 규칙을 적용하는 Collation은 더 많은 연산을 필요로 하지만 데이터의 의미에 맞는 정확한 결과를 제공합니다. 대부분의 경우 언어별 규칙을 적용하는 `_CI`(대소문자 미구분) Collation이 널리 사용됩니다.
